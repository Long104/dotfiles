{
  "version": 3,
  "sources": ["../src/import-dia-skill.ts"],
  "sourcesContent": ["import { getPreferenceValues, showToast, Toast, open, popToRoot, closeMainWindow } from \"@raycast/api\";\nimport { URLSearchParams } from \"url\";\n\ninterface RaySoPrompt {\n  creativity: string;\n  highlightEdits: boolean;\n  title: string;\n  model: string;\n  icon: string;\n  prompt: string;\n}\n\nconst extractWithRegex = (html: string, regex: RegExp): string => {\n  const match = html.match(regex);\n  return match?.[1]?.trim() ?? \"\";\n};\n\nexport default async function Command(props: { arguments: Arguments.ImportDiaSkill }) {\n  const { skillUrl } = props.arguments;\n\n  if (!skillUrl) {\n    await showToast({\n      style: Toast.Style.Failure,\n      title: \"Missing URL\",\n      message: \"Please provide a valid Dia skill URL\",\n    });\n    return;\n  }\n\n  if (!skillUrl.startsWith(\"https://www.diabrowser.com/skills/\")) {\n    await showToast({\n      style: Toast.Style.Failure,\n      title: \"Invalid URL\",\n      message: \"Please provide a valid URL from diabrowser.com/skills\",\n    });\n    return;\n  }\n\n  await showToast({ style: Toast.Style.Animated, title: \"Importing Skill...\" });\n\n  try {\n    const response = await fetch(skillUrl);\n    if (!response.ok) {\n      throw new Error(`HTTP error! status: ${response.status}`);\n    }\n    const html = await response.text();\n\n    // Extract shortcut name - look for the main heading or title\n    let shortcutName = extractWithRegex(html, /<h1[^>]*>([^<]+)<\\/h1>/);\n    if (!shortcutName) {\n      // Try title tag and remove site name\n      const titleText = extractWithRegex(html, /<title>([^<]+)<\\/title>/);\n      if (titleText) {\n        shortcutName = titleText.split(\" | \")[0].trim();\n      }\n    }\n    if (!shortcutName) {\n      // Fallback to meta property\n      shortcutName = extractWithRegex(html, /<meta property=\"og:title\" content=\"([^\"]+)\"/);\n    }\n\n    if (!shortcutName) {\n      throw new Error(\"Could not find skill name.\");\n    }\n\n    // Extract prompt - get everything from the rich text content area\n    let promptText = \"\";\n\n    // Look for the rich text div that contains the prompt\n    const richTextMatch = html.match(\n      /<div class=\"bg-fill-tertiary rounded-8 p-12\"><div class=\"rich-text[^\"]*\"[^>]*>([\\s\\S]*?)<\\/div><\\/div>/,\n    );\n    if (richTextMatch && richTextMatch[1]) {\n      // Extract text content from the HTML, removing tags but preserving structure\n      promptText = richTextMatch[1]\n        .replace(/<\\/p>/g, \"\\n\\n\") // Convert paragraph breaks to line breaks\n        .replace(/<\\/li>/g, \"\\n\") // Convert list items to line breaks\n        .replace(/<[^>]*>/g, \"\") // Remove all HTML tags\n        .replace(/&lt;/g, \"<\") // Decode HTML entities\n        .replace(/&gt;/g, \">\")\n        .replace(/&amp;/g, \"&\")\n        .replace(/&quot;/g, '\"')\n        .replace(/&#x27;/g, \"'\")\n        .replace(/\\n\\s*\\n\\s*\\n/g, \"\\n\\n\") // Clean up multiple line breaks\n        .trim();\n    }\n\n    if (!promptText) {\n      // Fallback to textarea or other patterns\n      promptText = extractWithRegex(html, /<textarea[^>]*>([\\s\\S]*?)<\\/textarea>/);\n    }\n\n    if (!promptText) {\n      // Final fallback to meta description\n      const descriptionMatch = html.match(/<meta name=\"description\" content=\"([^\"]+)\"/);\n      if (descriptionMatch && descriptionMatch[1]) {\n        promptText = descriptionMatch[1];\n      } else {\n        throw new Error(\"Could not find prompt text.\");\n      }\n    }\n\n    // Add the browser instruction prefix to the prompt\n    promptText =\n      \"@browser find relevant tabs and get their content (only if necessary) for the following:\\n\\n\" + promptText;\n\n    // Clean up the prompt text - decode HTML entities and normalize whitespace\n    promptText = promptText\n      .replace(/&lt;/g, \"<\")\n      .replace(/&gt;/g, \">\")\n      .replace(/&amp;/g, \"&\")\n      .replace(/&quot;/g, '\"')\n      .replace(/&#x27;/g, \"'\")\n      .trim();\n\n    // Construct the ray.so URL\n    const preferences = getPreferenceValues<Record<string, string>>();\n\n    const raySoData: RaySoPrompt = {\n      title: shortcutName,\n      prompt: promptText,\n      model: preferences.model || \"raycast-ray1\",\n      icon: preferences.icon || \"link\",\n      creativity: preferences.creativity || \"medium\",\n      highlightEdits: false,\n    };\n\n    const params = new URLSearchParams({ prompts: JSON.stringify(raySoData) });\n    const raySoUrl = `https://ray.so/prompts/shared?${params.toString()}`;\n\n    await open(raySoUrl);\n\n    await showToast({\n      style: Toast.Style.Success,\n      title: \"Successfully Imported Skill\",\n      message: `Opened \"${shortcutName}\" in ray.so`,\n    });\n\n    await closeMainWindow();\n    await popToRoot();\n  } catch (error) {\n    await showToast({\n      style: Toast.Style.Failure,\n      title: \"Failed to Import Skill\",\n      message: error instanceof Error ? error.message : String(error),\n    });\n  }\n}\n"],
  "mappings": "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",
  "names": ["import_dia_skill_exports", "__export", "Command", "__toCommonJS", "import_api", "import_url", "extractWithRegex", "html", "regex", "props", "skillUrl", "response", "shortcutName", "titleText", "promptText", "richTextMatch", "descriptionMatch", "preferences", "raySoData", "raySoUrl", "error"]
}
